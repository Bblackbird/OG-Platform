<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>
	<bean id="tssNamedSQLMap"  class="org.springframework.beans.factory.config.MapFactoryBean">
   		<property name="sourceMap">
      		<map>
        		<entry key="findDomainSpecIdentifiersByQuotedObject" value="SELECT d.name, dsi.identifier FROM tss_domain_spec_identifier dsi, tss_domain d, tss_quoted_object qo WHERE dsi.domain_id = d.id AND qo.id = dsi.quoted_obj_id AND qo.name = :quotedObject ORDER BY d.name"/>
        		<entry key="insertDomainSpecIdentifier" value="INSERT into tss_domain_spec_identifier (quoted_obj_id, domain_id, identifier) VALUES ((SELECT id FROM tss_quoted_object WHERE name = :quotedObject), (SELECT id FROM tss_domain WHERE name = :domain), :identifier)"/>
        		<entry key="findDataProviderIDbyName" value="SELECT id FROM tss_data_provider WHERE name  = :name"/>
        		<entry key="findDataProviderByID" value="SELECT name FROM tss_data_provider WHERE id  = :id"/>
        		<entry key="selectDataProviderID" value="SELECT id FROM tss_data_provider WHERE name = :name"/>
        		<entry key="loadAllDataProvider" value="SELECT name FROM tss_data_provider"/>
        		<entry key="insertDataProvider" value="INSERT INTO tss_data_provider (name, description) VALUES (:name, :description)"/>
        		<entry key="findDataSourceByID" value="SELECT name FROM tss_data_source WHERE id  = :id"/>
        		<entry key="selectDataSourceID" value="SELECT id FROM tss_data_source WHERE name = :name"/>
        		<entry key="insertDataSource" value="INSERT INTO tss_data_source (name, description) VALUES (:name, :description)"/>
        		<entry key="loadAllDataSources" value="SELECT name FROM tss_data_source"/>
        		<entry key="findDataFieldByID" value="SELECT name FROM tss_data_field WHERE id  = :id"/>
        		<entry key="insertDataField" value="INSERT INTO tss_data_field (name, description) VALUES (:name, :description)"/>
        		<entry key="selectDataFieldID" value="SELECT id FROM tss_data_field WHERE name = :name"/>
        		<entry key="loadAllDataFields" value="SELECT name FROM tss_data_field"/>
        		<entry key="findObservationTimeByID" value="SELECT name FROM tss_observation_time WHERE id  = :id"/>
        		<entry key="insertObservationTime" value="INSERT INTO tss_observation_time (name, description) VALUES (:name, :description)"/>
        		<entry key="selectObservationTimeID" value="SELECT id FROM tss_observation_time WHERE name = :name"/>
        		<entry key="loadAllObservationTimes" value="SELECT name FROM tss_observation_time"/>
        		<entry key="findQuotedObjectByID" value="SELECT name FROM tss_quoted_object WHERE id  = :id"/>
        		<entry key="insertQuotedObject" value="INSERT INTO tss_quoted_object (name, description) VALUES (:name, :description)"/>
        		<entry key="selectQuotedObjectID" value="SELECT id FROM tss_quoted_object WHERE name = :name"/>
        		<entry key="selectQuotedObjectFromIdentifiers" value="SELECT qo.name, count(qo.name) as count FROM tss_quoted_object qo, tss_domain_spec_identifier dsi, tss_domain d WHERE d.id = dsi.domain_id AND qo.id = dsi.quoted_obj_id"/>
        		<entry key="loadAllQuotedObjects" value="SELECT name FROM tss_quoted_object"/>
        		<entry key="findDomainIDbyName" value="SELECT id FROM tss_domain WHERE name  = :name"/>
        		<entry key="findDomainByID" value="SELECT name FROM tss_domain WHERE id  = :id"/>
        		<entry key="insertDomain" value="INSERT INTO tss_domain (name, description) VALUES (:name, :description)"/>
        		<entry key="selectDomainID" value="SELECT id FROM tss_domain WHERE name = :name"/>
        		<entry key="loadAllDomain" value="SELECT name FROM tss_domain"/>
        		<entry key="getTimeSeriesKeyIDByQuotedObject" 
        			   value="SELECT tskey.id FROM tss_time_series_key tskey, tss_quoted_object qo, tss_data_source ds, tss_data_provider dp, tss_data_field df, tss_observation_time ot WHERE tskey.quoted_obj_id = qo.id AND tskey.data_source_id = ds.id AND tskey.data_provider_id = dp.id AND tskey.data_field_id = df.id AND tskey.observation_time_id = ot.id AND qo.name = :quotedObject AND ds.name = :dataSource AND dp.name = :dataProvider AND df.name = :dataField AND ot.name = :observationTime"/>
        		<entry key="insertTimeSeriesKey" value="INSERT into tss_time_series_key (quoted_obj_id, data_source_id, data_provider_id, data_field_id, observation_time_id) VALUES ((SELECT id from tss_quoted_object where name = :quotedObject), (SELECT id from tss_data_source where name = :dataSource), (SELECT id from tss_data_provider where name = :dataProvider), (SELECT id from tss_data_field where name = :dataField), (SELECT id from tss_observation_time where name = :observationTime))"/>
        		<entry key="insertTimeSeries" value="INSERT INTO tss_time_series_data (time_series_id, ts_date, value) VALUES (:timeSeriesID, :date, :value)"/>
        		<entry key="insertTimeSeriesDeltaI" value="INSERT INTO tss_time_series_data_delta (time_series_id, time_stamp, ts_date, old_value, operation) VALUES (:timeSeriesID, :timeStamp, :date, :value, 'I')"/>
        		<entry key="insertTimeSeriesDeltaD" value="INSERT INTO tss_time_series_data_delta (time_series_id, time_stamp, ts_date, old_value, operation) VALUES (:timeSeriesID, :timeStamp, :date, :value, 'D')"/>
        		<entry key="insertTimeSeriesDeltaU" value="INSERT INTO tss_time_series_data_delta (time_series_id, time_stamp, ts_date, old_value, operation) VALUES (:tsID, :timeStamp, :date, :oldValue, 'U')"/>
        		<entry key="loadTimeSeries" value="SELECT ts_date, value FROM tss_time_series_data tsd WHERE time_series_id = :timeSeriesKey ORDER BY ts_date"/>
        		<entry> 
        			<key><value>loadTimeSeriesWithDates</value></key>
        			<value>
        				<![CDATA[
	        				SELECT ts_date, value FROM tss_time_series_data tsd WHERE time_series_id = :timeSeriesKey AND (tsd.ts_date >= :startDate AND ts_date <= :endDate) ORDER BY ts_date
	        			]]>
        			</value>
        		</entry>
        		<entry key="updateTimeSeries" value="UPDATE tss_time_series_data SET value = :newValue WHERE time_series_id = :tsID AND ts_date = :date "/>
        		<entry key="getTimeSeriesKeyIDByIdentifier" value="SELECT tsKey.id FROM tss_time_series_key tsKey, tss_quoted_object qo, tss_domain_spec_identifier dsi, tss_domain d, tss_data_source ds, tss_data_provider dp, tss_data_field df, tss_observation_time ot WHERE dsi.domain_id = d.id AND dsi.quoted_obj_id = qo.id AND tsKey.quoted_obj_id = qo.id AND tsKey.data_source_id = ds.id AND tsKey.data_provider_id = dp.id AND tsKey.data_field_id = df.id AND tsKey.observation_time_id = ot.id AND dsi.identifier = :identifier AND d.name = :domain AND ds.name = :dataSource AND df.name = :dataField AND (dp.name = :dataProvider OR :dataProvider IS NULL) AND (ot.name = :observationTime OR :observationTime IS NULL)"/>
        		<entry key="getTimeSeriesByID" value="SELECT ts_date, value FROM tss_time_series_data where time_series_id = :tsID"/>
        		<entry key="deleteTimeSeriesByID" value="DELETE FROM tss_time_series_data WHERE time_series_id = :tsID"/>
        		<entry key="findDataPointByDateAndID" value="SELECT value FROM tss_time_series_data WHERE time_series_id = :tsID AND ts_date = :date"/>
        		<entry key="deleteDataPoint" value="DELETE FROM tss_time_series_data WHERE time_series_id = :tsID AND ts_date = :date"/>
        		<entry key="loadTimeSeriesDelta" value="SELECT ts_date, old_value, operation FROM tss_time_series_data_delta WHERE time_series_id = :tsID AND time_stamp >= :time ORDER BY time_stamp desc"/>
        	</map>	
    	</property>
	</bean>
</beans>

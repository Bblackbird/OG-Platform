<project name="tomcat" xmlns:ivy="antlib:org.apache.ivy.ant">

	<property file="${common.dir}/tomcat.properties" />

	<target name="tomcat-config" depends="resolve">
		<taskdef name="deploy" classname="org.apache.catalina.ant.DeployTask" classpathref="lib.path.id" />
		<taskdef name="undeploy" classname="org.apache.catalina.ant.UndeployTask" classpathref="lib.path.id" />
		<property name="tomcat.app" value="${dist.name}" />
	</target>

	<target name="tomcat-war" depends="tomcat-config,compile" description="--> Create a Tomcat WAR file">
		<property name="war.dir" value="${dist.dir}/${tomcat.app}" />
		<property name="war.file" value="${war.dir}.war" />
		<mkdir dir="${war.dir}/WEB-INF/classes" />
		<copy todir="${war.dir}/WEB-INF/classes">
			<fileset dir="${classes.dir}" />
		</copy>
		<delete dir="${war.dir}/WEB-INF/lib" />
		<mkdir dir="${war.dir}/WEB-INF/lib" />
		<copy todir="${war.dir}/WEB-INF/lib" flatten="true">
			<fileset dir="${lib.dir}/jar">
				<include name="**/*.jar" />
			</fileset>
		</copy>
		<copy todir="${war.dir}">
			<fileset dir="${basedir}/web" />
		</copy>
		<jar jarfile="${war.file}" basedir="${war.dir}" />
	</target>

	<target name="tomcat-deploy" depends="tomcat-war" description="--> Install the Tomcat WAR">
		<deploy url="${tomcat.manager.url}"
			username="${tomcat.manager.username}"
			password="${tomcat.manager.password}"
			path="/${tomcat.app}"
			war="file://${war.file}" />
	</target>

	<target name="tomcat-undeploy" depends="tomcat-config" description="--> Unload the Tomcat WAR">
		<undeploy url="${tomcat.manager.url}"
			username="${tomcat.manager.username}"
			password="${tomcat.manager.password}"
			path="/${tomcat.app}" />
	</target>

	<target name="tomcat-reload" depends="tomcat-undeploy,tomcat-deploy" description="--> Reload the Tomcat WAR">
	</target>

</project>

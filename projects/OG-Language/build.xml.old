<project name="og-language" default="compile">

  <import file="${basedir}/build-prefix.xml" />

  <path id="java.build.path">
    <pathelement path="${basedir}/Client" />
  </path>
  <path id="javatest.build.path">
    <path refid="java.build.path" />
  </path>
  <path id="cc.build.path">
    <pathelement path="${basedir}/Util" />
    <pathelement path="${basedir}/Service" />
    <pathelement path="${basedir}/Connector" />
    <pathelement path="${basedir}/ServiceRunner" />
  </path>
  <path id="cctest.build.path">
    <pathelement path="${basedir}/UtilTest" />
    <pathelement path="${basedir}/ServiceTest" />
    <pathelement path="${basedir}/ConnectorTest" />
  </path>

  <import file="${basedir}/build-suffix.xml" />
  <import file="${basedir}/delete-unused-jars.xml" />
  <import file="${common.dir}/advanced-installer.xml" />

  <target name="deploy-jars" depends="build-suffix.deploy-jars,make-config,delete-unused-jars">
    <mkdir dir="${build.dir}/ext" />
    <copy file="${basedir}/config/0${ant.project.name}.xml" todir="${build.dir}/ext" failonerror="true" />
    <copy file="${basedir}/config/logback.xml" todir="${build.dir}" failonerror="false" />
  </target>

  <target name="fudge-proto" depends="build-suffix.fudge-proto">
    <subant target="proto-c" buildpath="${basedir}/Service">
      <property name="wkspace.dir" value="${wkspace.dir}" />
    </subant>
  </target>
  
  <target name="dist" depends="compile">
    <mkdir dir="${dist.dir}" />
    <mkdir dir="${dist.dir}/bin" />
    <mkdir dir="${dist.dir}/include" />
    <mkdir dir="${dist.dir}/lib" />
    <subant target="dist" buildpathref="java.build.path" antfile="build.parent-invoked.xml">
      <property name="wkspace.dir" value="${wkspace.dir}" />
    </subant>
    <subant target="dist" buildpathref="cc.build.path">
      <property name="wkspace.dir" value="${wkspace.dir}" />
    </subant>
    <zip destfile="${dist.dir}/${ant.project.name}-bin.zip" basedir="${dist.dir}/bin" whenempty="create" />
    <zip destfile="${dist.dir}/${ant.project.name}-include.zip" basedir="${dist.dir}/include" whenempty="create" />
    <zip destfile="${dist.dir}/${ant.project.name}-lib.zip" basedir="${dist.dir}/lib" whenempty="create" />
    <delete dir="${dist.dir}/bin" />
    <delete dir="${dist.dir}/include" />
    <delete dir="${dist.dir}/lib" />
  </target>

  <target name="windows-installer" depends="ai-present,module-build-number" if="ai.present" description="Builds the windows installation packages (assumes a dist has already been done and Advanced Installer is available)">
    <ai-set-version version="${module.version.msi}.${module.build.number}" />
    <ai-build />
  </target>

</project>

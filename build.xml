<project name="og-financial" default="compile">
	<property file="build.properties" />

	<import file="${common.dir}/common.xml" />

	<target name="create-db-sql-impl" if="dbscript.dir">
		<concat fixlastline="yes" force="no" destfile="${dbscript.dir}/create-db.sql">
			<header filtering="no" trimleading="true">
			-- IMPORTANT:
			--       
			-- This file was generated by concatenating the three other .sql files together. It can be used
			-- for testing, but the separate SQL sequences will be necessary if the Security Master and
			-- Position Master need to be installed in different databases.
			--
			-- Please do not modify it - modify the originals and recreate this using 'ant create-db-sql'.
			</header>
			<fileset file="${dbscript.dir}/create-db-security.sql" />
			<fileset file="${dbscript.dir}/create-db-position.sql" />
			<fileset file="${dbscript.dir}/create-db-common.sql" />
		</concat>
	</target>
	<available property="derby-db.sql" value="${basedir}/db/derby" file="${basedir}/db/derby/create-db-common.sql" />
	<target name="create-derby-db-sql" if="derby-db.sql">
		<subant target="create-db-sql-impl">
			<property name="dbscript.dir" value="${basedir}/db/derby" />
			<fileset file="${basedir}/build.xml" />
		</subant>
	</target>
	<available property="postgres-db.sql" value="${basedir}/db/postgres" file="${basedir}/db/postgres/create-db-common.sql" />
	<target name="create-postgres-db-sql" if="postgres-db.sql">
		<subant target="create-db-sql-impl">
			<property name="dbscript.dir" value="${basedir}/db/postgres" />
			<fileset file="${basedir}/build.xml" />
		</subant>
	</target>
	<target name="create-db-sql" depends="create-derby-db-sql,create-postgres-db-sql" description="--> create a single create-db.sql file from the component ones" />
	
	<target name="create-postgres-fin" description="--> run scripts to create database/user/schema/tables for financial db">
			<exec executable="${psql.path}"
		        failonerror="true">
		    	<arg value="--username"/>
				<arg value="postgres"/>
		    	<arg value="--host"/>
		    	<arg value="postgresql-lx-1.hq.opengamma.com"/>
		    	<arg value="--file"/>
		    	<arg value="db/postgres/create-og-fin-db-users.sql"/>
				<arg value="--dbname"/>
				<arg value="postgres"/>
		  	</exec>
			<exec executable="${psql.path}"
		        failonerror="true">
		    	<arg value="--username"/>
				<arg value="postgres"/>
		    	<arg value="--host"/>
		    	<arg value="postgresql-lx-1.hq.opengamma.com"/>
		    	<arg value="--file"/>
		    	<arg value="db/postgres/create-og-fin-schema.sql"/>
				<arg value="--dbname"/>
				<arg value="og_financial"/>
		  	</exec>
			<exec executable="${psql.path}" failonerror="true">
				<arg value="--username"/>
				<arg value="finowner"/>
		    	<arg value="--host"/>
		    	<arg value="postgresql-lx-1.hq.opengamma.com"/>
		    	<arg value="--file"/>
		    	<arg value="db/postgres/create-og-fin-tables.sql"/>
				<arg value="--dbname"/>
				<arg value="og_financial"/>
			</exec>
	</target>
</project>
